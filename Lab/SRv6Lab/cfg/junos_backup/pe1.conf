
## Last commit: 2026-01-21 15:24:35 UTC by admin
version 25.4R1.11;
groups {
    config1 {
        policy-options {
            policy-statement change_nh {
                term 1 {
                    then {
                        next-hop fc00:dead:beef:ff01::;
                        accept;
                    }
                }
            }
            policy-statement nh {
                term 1 {
                    from protocol bgp;
                    then {
                        next-hop fc00:dead:beef:ff01::;
                        accept;
                    }
                }
                term 2 {
                    from protocol evpn;
                    then {
                        next-hop fc00:dead:beef:ff01::;
                        accept;
                    }
                }
                term default {
                    then reject;
                }
            }
        }
        routing-options {
            resolution {
                preserve-nexthop-hierarchy;
            }
            autonomous-system 4200000001;
        }
        protocols {
            bgp {
                vpn-apply-export;
                group to_rr {
                    type internal;
                    local-address fc00:dead:beef:ffff::ffff:1;
                    family inet {
                        unicast {
                            extended-nexthop;
                            advertise-srv6-service;
                            accept-srv6-service;
                        }
                    }
                    family inet-vpn {
                        unicast {
                            extended-nexthop;
                            advertise-srv6-service;
                            accept-srv6-service;
                        }
                    }
                    family inet6 {
                        unicast {
                            advertise-srv6-service;
                            accept-srv6-service;
                        }
                    }
                    family inet6-vpn {
                        unicast {
                            advertise-srv6-service;
                            accept-srv6-service;
                        }
                    }
                    family evpn {
                        signaling {
                            advertise-srv6-service;
                            accept-srv6-service;
                        }
                    }
                    export nh;
                    neighbor fc00:dead:beef:ffff::ffff:10;
                }
                multipath {
                    list-nexthop;
                }
                rfc8950-compliant;
            }
        }
    }
    config1_l3vpn {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1001 {
                    vlan-id 1001;
                    family inet {
                        address 10.1.1.0/31;
                    }
                    family inet6 {
                        address fc00:deed:beef:f001::0/127;
                    }
                }
            }
        }
        routing-instances {
            l3vpn1 {
                instance-type vrf;
                protocols {
                    bgp {
                        group to_ce1 {
                            peer-as 4200001001;
                            neighbor 10.1.1.1 {
                                family inet {
                                    unicast;
                                }
                            }
                            neighbor fc00:deed:beef:f001::1 {
                                family inet6 {
                                    unicast;
                                }
                            }
                        }
                        source-packet-routing {
                            srv6 {
                                locator SRV6-LOC-1 {
                                    end-dt46-sid;
                                }
                            }
                        }
                    }
                }
                interface ge-0/0/0.1001;
                route-distinguisher 172.16.255.1:1001;
                vrf-target target:65000:1001;
                vrf-table-label;
            }
        }
    }
    config1_iprouting {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1000 {
                    vlan-id 1000;
                    family inet {
                        address 10.1.1.0/31;
                    }
                    family inet6 {
                        address fc00:deed:beef:f001::0/127;
                    }
                }
            }
        }
        protocols {
            bgp {
                group to_ce1_cust0 {
                    peer-as 4200009001;
                    neighbor 10.1.1.1 {
                        family inet {
                            unicast;
                        }
                    }
                    neighbor fc00:deed:beef:f001::1 {
                        family inet6 {
                            unicast;
                        }
                    }
                }
                source-packet-routing {
                    srv6 {
                        locator SRV6-LOC-1 {
                            end-dt46-sid;
                        }
                    }
                }
            }
        }
    }
    config1_evpn {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1010 {
                    encapsulation vlan-bridge;
                    vlan-id 1010;
                }
                unit 1070 {
                    encapsulation vlan-ccc;
                    vlan-id 1070;
                }
                unit 1020 {
                    encapsulation vlan-bridge;
                    vlan-id 1020;
                }
            }
            irb {
                unit 1020 {
                    family inet {
                        address 192.168.10.254/24;
                    }
                    family inet6 {
                        address fc00:deed:beef:f010::1/64;
                    }
                }
            }
            lo0 {
                unit 1020 {
                    family inet {
                        address 10.1.10.1/32;
                    }
                    family inet6 {
                        address fc00:dead:beef:aff1::1/128;
                    }
                }
            }
        }
        policy-options {
            policy-statement t5-export {
                term 1 {
                    from protocol direct;
                    then accept;
                }
                term default {
                    then reject;
                }
            }
        }
        routing-instances {
            evpn1 {
                instance-type mac-vrf;
                protocols {
                    evpn {
                        encapsulation srv6;
                        source-packet-routing {
                            srv6 locator SRV6-LOC-1 end-dt2-sid;
                        }
                    }
                }
                bridge-domains {
                    br1 {
                        vlan-id 1010;
                        interface ge-0/0/0.1010;
                    }
                }
                service-type vlan-based;
                interface ge-0/0/0.1010;
                route-distinguisher 172.16.255.1:1010;
                vrf-target target:65000:1010;
            }
            evpn-vpws1 {
                instance-type evpn-vpws;
                protocols {
                    evpn {
                        interface ge-0/0/0.1070 {
                            vpws-service-id {
                                local 103;
                                remote 301;
                                source-packet-routing {
                                    srv6 locator SRV6-LOC-1;
                                }
                            }
                        }
                        encapsulation srv6;
                    }
                }
                interface ge-0/0/0.1070;
                route-distinguisher 172.16.255.1:1070;
                vrf-target target:65000:1070;
            }
            evpn2 {
                instance-type mac-vrf;
                protocols {
                    evpn {
                        encapsulation srv6;
                        source-packet-routing {
                            srv6 locator SRV6-LOC-1 end-dt2-sid;
                        }
                    }
                }
                bridge-domains {
                    br1 {
                        vlan-id 1020;
                        interface ge-0/0/0.1020;
                    }
                }
                service-type vlan-based;
                route-distinguisher 172.16.255.1:1021;
                vrf-target target:65000:1021;
            }
            evpn2_l3vpn {
                instance-type vrf;
                protocols {
                    evpn {
                        ip-prefix-routes {
                            advertise direct-nexthop;
                            encapsulation srv6;
                            export t5-export;
                            source-packet-routing {
                                srv6 {
                                    locator SRV6-LOC-1 {
                                        end-dt46-sid;
                                    }
                                }
                            }
                        }
                    }
                }
                interface irb.1020;
                interface lo0.1020;
                route-distinguisher 172.16.255.1:1020;
                vrf-target target:65000:1020;
                vrf-table-label;
            }
        }
    }
    srv6 {
        interfaces {
            ge-0/0/0 {
                description "connection to port eth1 of lxc";
                mtu 9000;
            }
            ge-0/0/1 {
                description "connection to port eth5 of lxc";
                mtu 9000;
            }
            ge-0/0/2 {
                description "connection to port ge-0/0/0 of p1";
                mtu 9000;
                unit 0 {
                    family iso;
                    family inet6;
                }
            }
            ge-0/0/3 {
                description "connection to port ge-0/0/0 of p2";
                mtu 9000;
                unit 0 {
                    family iso;
                    family inet6;
                }
            }
            lo0 {
                unit 0 {
                    family inet {
                        address 172.16.255.1/32 {
                            primary;
                            preferred;
                        }
                    }
                    family iso {
                        address 49.0001.0001.0001.00;
                    }
                    family inet6 {
                        address fc00:dead:beef:ffff::ffff:1/128;
                    }
                }
            }
        }
        policy-options {
            policy-statement LB {
                term 1 {
                    then {
                        load-balance per-flow;
                        accept;
                    }
                }
            }
        }
        routing-options {
            source-packet-routing {
                srv6 {
                    locator SRV6-LOC-1 fc00:dead:beef:ff01::/64;
                }
            }
            route-distinguisher-id 172.16.255.1;
            router-id 172.16.255.1;
            forwarding-table {
                export LB;
            }
        }
        protocols {
            isis {
                interface ge-0/0/2.0 {
                    level 1 disable;
                    point-to-point;
                    family inet {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                    family inet6 {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                }
                interface ge-0/0/3.0 {
                    level 1 disable;
                    point-to-point;
                    family inet {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                    family inet6 {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                }
                interface lo0.0 {
                    level 1 disable;
                    passive;
                }
                source-packet-routing {
                    srv6 {
                        locator SRV6-LOC-1 {
                            end-sid fc00:dead:beef:ff01::;
                        }
                    }
                }
                level 2 {
                    authentication-key "$9$H.fQ69A0BE9CK8LxsYTzF/9AtuO1Ec";
                    authentication-type md5;
                }
            }
            lldp {
                interface all;
                interface fxp0 {
                    disable;
                }
            }
        }
    }
    mpls {
        interfaces {
            lo0 {
                unit 0 {
                    family inet {
                        address 172.16.255.1/32 {
                            primary;
                            preferred;
                        }
                    }
                    family iso {
                        address 49.0001.0001.0001.00;
                    }
                }
            }
            ge-0/0/0 {
                description "connection to port eth1 of lxc";
                mtu 9000;
            }
            ge-0/0/1 {
                description "connection to port eth5 of lxc";
                mtu 9000;
            }
            ge-0/0/2 {
                description "connection to port ge-0/0/0 of p1";
                mtu 9000;
                unit 0 {
                    family inet {
                        address 172.16.20.2/31;
                    }
                    family iso;
                    family mpls;
                }
            }
            ge-0/0/3 {
                description "connection to port ge-0/0/0 of p2";
                mtu 9000;
                unit 0 {
                    family inet {
                        address 172.16.20.4/31;
                    }
                    family iso;
                    family mpls;
                }
            }
        }
        policy-options {
            policy-statement LB {
                term 1 {
                    then {
                        load-balance per-flow;
                        accept;
                    }
                }
            }
        }
        routing-options {
            route-distinguisher-id 172.16.255.1;
            router-id 172.16.255.1;
            forwarding-table {
                export LB;
            }
        }
        protocols {
            isis {
                interface lo0.0 {
                    level 1 disable;
                    passive;
                }
                interface ge-0/0/2.0 {
                    level 1 disable;
                    point-to-point;
                    family inet {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                    family inet6 {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                }
                interface ge-0/0/3.0 {
                    level 1 disable;
                    point-to-point;
                    family inet {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                    family inet6 {
                        bfd-liveness-detection {
                            minimum-interval 100;
                        }
                    }
                }
                level 2 {
                    authentication-key "$9$H.fQ69A0BE9CK8LxsYTzF/9AtuO1Ec";
                    authentication-type md5;
                }
            }
            ldp {
                interface ge-0/0/2.0;
                interface ge-0/0/3.0;
            }
            mpls {
                statistics {
                    interval 10;
                }
                sensor-based-stats;
                interface ge-0/0/2.0;
                interface ge-0/0/3.0;
            }
            rsvp {
                interface ge-0/0/2.0;
                interface ge-0/0/3.0;
            }
            lldp {
                interface all;
                interface fxp0 {
                    disable;
                }
            }
        }
    }
    config2 {
        policy-options {
            policy-statement nh {
                term 1 {
                    from protocol [ bgp evpn ];
                    then {
                        next-hop self;
                        accept;
                    }
                }
                term default {
                    then reject;
                }
            }
        }
        routing-options {
            autonomous-system 4200000001;
        }
        protocols {
            bgp {
                vpn-apply-export;
                group to_rr {
                    type internal;
                    local-address 172.16.255.1;
                    family inet {
                        unicast;
                    }
                    family inet6 {
                        labeled-unicast {
                            explicit-null;
                        }
                    }
                    family evpn {
                        signaling;
                    }
                    export nh;
                    neighbor 172.16.255.10;
                }
            }
        }
    }
    config2_iprouting {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1000 {
                    vlan-id 1000;
                    family inet {
                        address 10.1.1.0/31;
                    }
                    family inet6 {
                        address fc00:deed:beef:f001::0/127;
                    }
                }
            }
            ge-0/0/2 {
                unit 0 {
                    family inet6;
                }
            }
            ge-0/0/3 {
                unit 0 {
                    family inet6;
                }
            }
        }
        protocols {
            bgp {
                group to_ce1_cust0 {
                    peer-as 4200009001;
                    neighbor 10.1.1.1 {
                        family inet {
                            unicast;
                        }
                    }
                    neighbor fc00:deed:beef:f001::1 {
                        family inet6 {
                            unicast;
                        }
                    }
                }
            }
            mpls {
                explicit-null;
                ipv6-tunneling;
            }
        }
    }
    config2_l3vpn {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1001 {
                    vlan-id 1001;
                    family inet {
                        address 10.1.1.0/31;
                    }
                    family inet6 {
                        address fc00:deed:beef:f001::0/127;
                    }
                }
            }
        }
        routing-instances {
            l3vpn1 {
                instance-type vrf;
                protocols {
                    bgp {
                        group to_ce1 {
                            peer-as 4200001001;
                            neighbor 10.1.1.1 {
                                family inet {
                                    unicast;
                                }
                            }
                            neighbor fc00:deed:beef:f001::1 {
                                family inet6 {
                                    unicast;
                                }
                            }
                        }
                    }
                    evpn {
                        ip-prefix-routes {
                            advertise direct-nexthop;
                        }
                    }
                }
                interface ge-0/0/0.1001;
                route-distinguisher 172.16.255.1:1001;
                vrf-target target:65000:1001;
                vrf-table-label;
            }
        }
    }
    config2_evpn {
        interfaces {
            ge-0/0/0 {
                flexible-vlan-tagging;
                encapsulation flexible-ethernet-services;
                unit 1010 {
                    encapsulation vlan-bridge;
                    vlan-id 1010;
                }
                unit 1020 {
                    encapsulation vlan-bridge;
                    vlan-id 1020;
                }
            }
            irb {
                unit 1020 {
                    family inet {
                        address 192.168.10.254/24;
                    }
                    family inet6 {
                        address fc00:deed:beef:f010::1/64;
                    }
                }
            }
        }
        routing-instances {
            evpn1 {
                instance-type evpn;
                protocols {
                    evpn;
                }
                interface ge-0/0/0.1010;
                route-distinguisher 172.16.255.1:1010;
                vrf-target target:65000:1010;
            }
            evpn2 {
                instance-type evpn;
                protocols {
                    evpn;
                }
                vlan-id none;
                routing-interface irb.1020;
                interface ge-0/0/0.1020;
                route-distinguisher 172.16.255.1:1022;
                vrf-target target:65000:1021;
            }
            evpn2_l3vpn {
                instance-type vrf;
                protocols {
                    evpn {
                        ip-prefix-routes {
                            advertise direct-nexthop;
                        }
                    }
                }
                interface irb.1020;
                route-distinguisher 172.16.255.1:1020;
                vrf-target target:65000:1020;
                vrf-table-label;
            }
        }
    }
}
apply-groups [ srv6 config1 config1_iprouting config1_l3vpn config1_evpn ];
system {
    host-name pe1;
    root-authentication {
        encrypted-password "$1$hQigBmXp$J3u5ZqHqRX3C.qNpfxrPr0";
    }
    login {
        user admin {
            uid 2000;
            class super-user;
            authentication {
                encrypted-password "$1$hQigBmXp$J3u5ZqHqRX3C.qNpfxrPr0";
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCK6O/OBtLVrPmoGNEM/VYW9INFJDk/ZpR4gYucZ9S963PAmBeq4tA0ptGA7NhCav3Xoi5KiQaIer2Sotgmi2S/BWCAF5siEv1Mnq1cJ69QbNv+9wLtzoIYxuis18ugsPFzMz4S+SQjyfu94W8FkU/lJ7xVgbY0nMS9e1gpwlvKAZsYgcGpUdOx6um1dortnuGQwH8b8ygZjEQ+5ottwDAWJ1v+e/jvO5dS+GF3MCpBN/7RmOWQzSFi/bqXyrZdTb2BBxPH2XO5fqPFNann9V+L5YAH+ImLE5ruU3fQAN1XFw/0V5y7bHWNPu6NuqKoUJm3YPVH1vlZ5lM4/e+oMsst";
            }
        }
    }
    services {
        netconf {
            ssh;
        }
        ssh {
            root-login allow;
            sftp-server;
        }
    }
    default-address-selection;
    management-instance;
    syslog {
        user * {
            any emergency;
        }
        file interactive-commands {
            interactive-commands any;
        }
        file messages {
            any notice;
            authorization info;
        }
    }
}
chassis {
    network-services enhanced-ip;
}
interfaces {
    fxp0 {
        unit 0 {
            family inet {
                address 172.16.11.21/24;
            }
        }
    }
}
