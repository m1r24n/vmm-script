# router pe1

set groups config1 policy-options policy-statement change_nh term 1 then next-hop fc00:dead:beef:ff01::
set groups config1 policy-options policy-statement change_nh term 1 then accept
set groups config1 policy-options policy-statement nh term 1 from protocol bgp
set groups config1 policy-options policy-statement nh term 1 then next-hop fc00:dead:beef:ff01::
set groups config1 policy-options policy-statement nh term 1 then accept
set groups config1 policy-options policy-statement nh term 2 from protocol evpn
set groups config1 policy-options policy-statement nh term 2 then next-hop fc00:dead:beef:ff01::
set groups config1 policy-options policy-statement nh term 2 then accept
set groups config1 policy-options policy-statement nh term default then reject
set groups config1 routing-options resolution preserve-nexthop-hierarchy
set groups config1 routing-options autonomous-system 4200000001
set groups config1 protocols bgp vpn-apply-export
set groups config1 protocols bgp group to_rr type internal
set groups config1 protocols bgp group to_rr local-address fc00:dead:beef:ffff::ffff:1
set groups config1 protocols bgp group to_rr family inet unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling advertise-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling accept-srv6-service
set groups config1 protocols bgp group to_rr export nh
set groups config1 protocols bgp group to_rr neighbor fc00:dead:beef:ffff::ffff:10
set groups config1 protocols bgp multipath list-nexthop
set groups config1 protocols bgp rfc8950-compliant

set apply-groups config1

set groups config_l3vpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_l3vpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 vlan-id 1001
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 family inet address 10.1.1.0/31
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 family inet6 address fc00:deed:beef:f001::0/127
set groups config_l3vpn routing-instances l3vpn1 instance-type vrf
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 peer-as 4200001001
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 neighbor 10.1.1.1 family inet unicast
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 neighbor fc00:deed:beef:f001::1 family inet6 unicast
set groups config_l3vpn routing-instances l3vpn1 protocols bgp source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_l3vpn routing-instances l3vpn1 interface ge-0/0/0.1001
set groups config_l3vpn routing-instances l3vpn1 route-distinguisher 172.16.255.1:1001
set groups config_l3vpn routing-instances l3vpn1 vrf-target target:65000:1001
set groups config_l3vpn routing-instances l3vpn1 vrf-table-label
set apply-groups config_l3vpn

set groups config_iprouting interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_iprouting interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_iprouting interfaces ge-0/0/0 unit 1000 vlan-id 1000
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet address 10.1.1.0/31
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet6 address fc00:deed:beef:f001::0/127
set groups config_iprouting  protocols bgp group to_ce1_cust0 peer-as 4200009001
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor 10.1.1.1 family inet unicast
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor fc00:deed:beef:f001::1 family inet6 unicast
set groups config_iprouting  protocols bgp source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_iprouting  interface ge-0/0/0.1000
set apply-groups config_iprouting


set groups config_evpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_evpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_evpn interfaces ge-0/0/0 unit 1010 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1010 vlan-id 1010
set groups config_evpn routing-instances evpn1 instance-type mac-vrf
set groups config_evpn routing-instances evpn1 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn1 protocols evpn source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn1 protocols evpn source-packet-routing srv6 locator end-dt2-sid
set groups config_evpn routing-instances evpn1 bridge-domains br1 vlan-id none
set groups config_evpn routing-instances evpn1 bridge-domains br1 interface ge-0/0/0.1010
set groups config_evpn routing-instances evpn1 service-type vlan-based
set groups config_evpn routing-instances evpn1 route-distinguisher 172.16.255.1:1010
set groups config_evpn routing-instances evpn1 vrf-target target:65000:1010
set apply-groups config_evpn


set groups config_evpn interfaces ge-0/0/0 unit 1070 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1070 vlan-id 1070
set groups config_evpn routing-instances evpn-vpws1 instance-type evpn-vpws
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id local 103
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id remote 301
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn-vpws1 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn-vpws1 interface ge-0/0/0.1070
set groups config_evpn routing-instances evpn-vpws1 route-distinguisher 172.16.255.1:1070
set groups config_evpn routing-instances evpn-vpws1 vrf-target target:65000:1070

# router pe2


delete groups config1
set groups config1 policy-options policy-statement nh term 1 from protocol bgp
set groups config1 policy-options policy-statement nh term 1 then next-hop fc00:dead:beef:ff02::
set groups config1 policy-options policy-statement nh term 1 then accept
set groups config1 policy-options policy-statement nh term 2 from protocol evpn
set groups config1 policy-options policy-statement nh term 2 then next-hop fc00:dead:beef:ff02::
set groups config1 policy-options policy-statement nh term 2 then accept
set groups config1 policy-options policy-statement nh term default then reject
set groups config1 routing-options resolution preserve-nexthop-hierarchy
set groups config1 routing-options autonomous-system 4200000001
set groups config1 protocols bgp group to_rr type internal
set groups config1 protocols bgp group to_rr local-address fc00:dead:beef:ffff::ffff:2
set groups config1 protocols bgp group to_rr family inet unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling advertise-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling accept-srv6-service
set groups config1 protocols bgp group to_rr export nh
set groups config1 protocols bgp group to_rr neighbor fc00:dead:beef:ffff::ffff:10
set groups config1 protocols bgp multipath list-nexthop
set groups config1 protocols bgp rfc8950-compliant

set apply-groups config1


set groups config_evpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_evpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_evpn interfaces ge-0/0/0 unit 1010 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1010 vlan-id 1010
set groups config_evpn routing-instances evpn1 instance-type mac-vrf
set groups config_evpn routing-instances evpn1 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn1 protocols evpn source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn1 protocols evpn source-packet-routing srv6 locator end-dt2-sid
set groups config_evpn routing-instances evpn1 bridge-domains br1 vlan-id 1010
set groups config_evpn routing-instances evpn1 bridge-domains br1 interface ge-0/0/0.1010
set groups config_evpn routing-instances evpn1 service-type vlan-based
set groups config_evpn routing-instances evpn1 interface ge-0/0/0.1010
set groups config_evpn routing-instances evpn1 route-distinguisher 172.16.255.2:1010
set groups config_evpn routing-instances evpn1 vrf-target target:65000:1010
set apply-groups config_evpn


set groups config_evpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_evpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_evpn interfaces ge-0/0/0 unit 1020 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1020 vlan-id 1020
set groups config_evpn routing-instances evpn2 instance-type mac-vrf
set groups config_evpn routing-instances evpn2 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn2 protocols evpn source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn2 protocols evpn source-packet-routing srv6 locator end-dt2-sid
set groups config_evpn routing-instances evpn2 bridge-domains br1 vlan-id 1020
set groups config_evpn routing-instances evpn2 bridge-domains br1 interface ge-0/0/0.1020
set groups config_evpn routing-instances evpn2 service-type vlan-based
set groups config_evpn routing-instances evpn2 interface ge-0/0/0.1020
set groups config_evpn routing-instances evpn2 route-distinguisher 172.16.255.2:1020
set groups config_evpn routing-instances evpn2 vrf-target target:65000:1020








# router pe3

delete groups config1
set groups config1 routing-options resolution preserve-nexthop-hierarchy
set groups config1 routing-options autonomous-system 4200000001
set groups config1 protocols bgp group to_rr type internal
set groups config1 protocols bgp group to_rr local-address fc00:dead:beef:ffff::ffff:3
set groups config1 protocols bgp group to_rr family inet-vpn unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling advertise-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast accept-srv6-service
set groups config1 protocols bgp group to_rr neighbor fc00:dead:beef:ffff::ffff:10
set groups config1 protocols bgp multipath list-nexthop
set groups config1 protocols bgp rfc8950-compliant
set groups config1 policy-options policy-statement nh term 1 from protocol bgp
set groups config1 policy-options policy-statement nh term 1 then next-hop fc00:dead:beef:ff03::
set groups config1 policy-options policy-statement nh term 1 then accept
set groups config1 policy-options policy-statement nh term 2 from protocol evpn
set groups config1 policy-options policy-statement nh term 2 then next-hop fc00:dead:beef:ff03::
set groups config1 policy-options policy-statement nh term 2 then accept
set groups config1 policy-options policy-statement nh term default then reject
set groups config1 protocols bgp group to_rr export nh
set apply-groups config1

set groups config_l3vpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_l3vpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 vlan-id 1001
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 family inet address 10.1.1.2/31
set groups config_l3vpn interfaces ge-0/0/0 unit 1001 family inet6 address fc00:deed:beef:f001::2/127
set groups config_l3vpn routing-instances l3vpn1 instance-type vrf
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 peer-as 4200001003
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 neighbor 10.1.1.3 family inet unicast
set groups config_l3vpn routing-instances l3vpn1 protocols bgp group to_ce1_cust1 neighbor fc00:deed:beef:f001::3 family inet6 unicast
set groups config_l3vpn routing-instances l3vpn1 protocols bgp source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_l3vpn routing-instances l3vpn1 interface ge-0/0/0.1001
set groups config_l3vpn routing-instances l3vpn1 route-distinguisher 172.16.255.3:1001
set groups config_l3vpn routing-instances l3vpn1 vrf-target target:65000:1001
set groups config_l3vpn routing-instances l3vpn1 vrf-table-label

set apply-groups config_l3vpn


set groups config_iprouting interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_iprouting interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_iprouting interfaces ge-0/0/0 unit 1000 vlan-id 1000
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet address 10.1.1.2/31
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet6 address fc00:deed:beef:f001::2/127
set groups config_iprouting  protocols bgp group to_ce1_cust0 peer-as 4200009003
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor 10.1.1.3 family inet unicast
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor fc00:deed:beef:f001::3 family inet6 unicast
set groups config_iprouting  protocols bgp source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_iprouting  interface ge-0/0/0.1000
set apply-groups config_iprouting


set groups config_evpn interfaces ge-0/0/0 unit 1070 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1070 vlan-id 1070
set groups config_evpn routing-instances evpn-vpws1 instance-type evpn-vpws
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id local 301
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id remote 103
set groups config_evpn routing-instances evpn-vpws1 protocols evpn interface ge-0/0/0.1070 vpws-service-id source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn-vpws1 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn-vpws1 interface ge-0/0/0.1070
set groups config_evpn routing-instances evpn-vpws1 route-distinguisher 172.16.255.3:1070
set groups config_evpn routing-instances evpn-vpws1 vrf-target target:65000:1070




# router pe4

delete groups config1
set groups config1 routing-options resolution preserve-nexthop-hierarchy
set groups config1 routing-options autonomous-system 4200000001
set groups config1 protocols bgp group to_rr type internal
set groups config1 protocols bgp group to_rr local-address fc00:dead:beef:ffff::ffff:4
set groups config1 protocols bgp group to_rr family inet-vpn unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6-vpn unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet6 unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast extended-nexthop
set groups config1 protocols bgp group to_rr family inet unicast advertise-srv6-service
set groups config1 protocols bgp group to_rr family inet unicast accept-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling advertise-srv6-service
set groups config1 protocols bgp group to_rr family evpn signaling accept-srv6-service
set groups config1 protocols bgp group to_rr neighbor fc00:dead:beef:ffff::ffff:10
set groups config1 protocols bgp multipath list-nexthop
set groups config1 protocols bgp rfc8950-compliant
set groups config1 policy-options policy-statement nh term 1 from protocol bgp
set groups config1 policy-options policy-statement nh term 1 then next-hop fc00:dead:beef:ff04::
set groups config1 policy-options policy-statement nh term 1 then accept
set groups config1 policy-options policy-statement nh term 2 from protocol evpn
set groups config1 policy-options policy-statement nh term 2 then next-hop fc00:dead:beef:ff04::
set groups config1 policy-options policy-statement nh term 2 then accept
set groups config1 policy-options policy-statement nh term default then reject
set groups config1 protocols bgp group to_rr export nh
set apply-groups config1


set groups config_iprouting interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_iprouting interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_iprouting interfaces ge-0/0/0 unit 1000 vlan-id 1000
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet address 10.1.1.4/31
set groups config_iprouting interfaces ge-0/0/0 unit 1000 family inet6 address fc00:deed:beef:f001::4/127
set groups config_iprouting  protocols bgp group to_ce1_cust0 peer-as 4200009004
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor 10.1.1.5 family inet unicast
set groups config_iprouting  protocols bgp group to_ce1_cust0 neighbor fc00:deed:beef:f001::5 family inet6 unicast
set groups config_iprouting  protocols bgp source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_iprouting  interface ge-0/0/0.1000
set apply-groups config_iprouting



set groups config_evpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_evpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_evpn interfaces ge-0/0/0 unit 1020 encapsulation vlan-bridge
set groups config_evpn interfaces ge-0/0/0 unit 1020 vlan-id 1020
set groups config_evpn routing-instances evpn2 instance-type mac-vrf
set groups config_evpn routing-instances evpn2 protocols evpn encapsulation srv6
set groups config_evpn routing-instances evpn2 protocols evpn source-packet-routing srv6 locator SRV6-LOC-1
set groups config_evpn routing-instances evpn2 protocols evpn source-packet-routing srv6 locator end-dt2-sid
set groups config_evpn routing-instances evpn2 bridge-domains br1 vlan-id 1020
set groups config_evpn routing-instances evpn2 bridge-domains br1 interface ge-0/0/0.1020
set groups config_evpn routing-instances evpn2 service-type vlan-based
set groups config_evpn routing-instances evpn2 interface ge-0/0/0.1020
set groups config_evpn routing-instances evpn2 route-distinguisher 172.16.255.3:1020
set groups config_evpn routing-instances evpn2 vrf-target target:65000:1020
set apply-groups config_evpn



set groups config_evpn interfaces ge-0/0/0 flexible-vlan-tagging
set groups config_evpn interfaces ge-0/0/0 encapsulation flexible-ethernet-services
set groups config_evpn interfaces ge-0/0/0 unit 1050 vlan-id 1050
set groups config_evpn interfaces ge-0/0/0 unit 1050 family inet address 192.168.14.254/24
set groups config_evpn interfaces ge-0/0/0 unit 1050 family inet6 address fc00:dead:beef:aa14::1/64

set groups config_evpn routing-instances evpn3 instance-type vrf
set groups config_evpn routing-instances evpn3 protocols evpn ip-prefix-routes advertise direct-nexthop
set groups config_evpn routing-instances evpn3 protocols evpn ip-prefix-routes encapsulation srv6
set groups config_evpn routing-instances evpn3 protocols evpn ip-prefix-routes source-packet-routing srv6 locator SRV6-LOC-1 end-dt46-sid
set groups config_evpn routing-instances evpn3 interface ge-0/0/0.1050
set groups config_evpn routing-instances evpn3 route-distinguisher 172.16.255.4:1050
set groups config_evpn routing-instances evpn3 vrf-target target:65000:1050
set groups config_evpn routing-instances evpn3 vrf-table-label
